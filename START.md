# ‚ö° –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

## üìù –ß—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏

–ú—ã —Å–æ–∑–¥–∞–ª–∏ –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É Backend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å 4 —Ñ–∞–π–ª–∞–º–∏:

1. **cmd/main.go** - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
2. **asterisk/ari.go** - –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Asterisk
3. **backend/listener.go** - –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏–π (—Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ!)
4. **db/db.go** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å

‚úÖ –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Asterisk ARI
‚úÖ –°–ª—É—à–∞–µ—Ç –í–°–ï —Å–æ–±—ã—Ç–∏—è –æ—Ç Asterisk
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π –∑–≤–æ–Ω–æ–∫ –≤ SQLite
‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç:
   - –ö—Ç–æ –∑–≤–æ–Ω–∏–ª
   - –ö–æ–º—É –∑–≤–æ–Ω–∏–ª
   - –ö–æ–≥–¥–∞ –Ω–∞—á–∞–ª—Å—è
   - –ö–æ–≥–¥–∞ –æ—Ç–≤–µ—Ç–∏–ª–∏
   - –ö–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è
   - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üöÄ –®–∞–≥ 1: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

```bash
# –°–∫–æ–ø–∏—Ä—É–π –≤—Å–µ —Ñ–∞–π–ª—ã –≤ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç go-server-asterisk/
cp -r go-backend-code/* /path/to/your/go-server-asterisk/
```

–î–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å—Å—è —Ç–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
go-server-asterisk/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ asterisk/
‚îÇ   ‚îî‚îÄ‚îÄ ari.go
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îî‚îÄ‚îÄ listener.go
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ db.go
‚îî‚îÄ‚îÄ go.mod
```

## üöÄ –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd /path/to/your/go-server-asterisk

# –°–∫–∞—á–∞–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
go mod download

# –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏ tidy –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
go mod tidy
```

## üöÄ –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Asterisk Dialplan

**–í–ê–ñ–ù–û!** –ë–µ–∑ —ç—Ç–æ–≥–æ —à–∞–≥–∞ –∑–≤–æ–Ω–∫–∏ –Ω–µ –±—É–¥—É—Ç –ø–æ–ø–∞–¥–∞—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

–û—Ç–∫—Ä–æ–π `/etc/asterisk/extensions.conf` –∏ –¥–æ–±–∞–≤—å:

```ini
[internal]
; –í—Å–µ –∑–≤–æ–Ω–∫–∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ Stasis –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
exten => _X.,1,NoOp(Call Center App)
 same => n,Stasis(callcenter-app)
 same => n,Hangup()
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ dialplan:
```bash
asterisk -rx "dialplan reload"
```

–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ dialplan –∑–∞–≥—Ä—É–∑–∏–ª—Å—è:
```bash
asterisk -rx "dialplan show internal"
```

## üöÄ –®–∞–≥ 4: –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫!

```bash
cd cmd
go run main.go
```

–¢—ã –¥–æ–ª–∂–µ–Ω —É–≤–∏–¥–µ—Ç—å:

```
üöÄ –ó–∞–ø—É—Å–∫ Call Center Server...
‚öôÔ∏è  –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞:
   ARI URL: http://192.168.88.206:8088/ari
   ARI App: callcenter-app
   HTTP Port: 3000
   Database: ./callcenter.db
üì¶ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: ./callcenter.db
üîÑ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞
üìû –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Asterisk ARI: http://192.168.88.206:8088/ari
üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Asterisk ARI: http://192.168.88.206:8088/ari
üìä Asterisk Info:
   Version: 22.6.0
   Entity ID: ...
‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Asterisk ARI
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Asterisk ARI
üéß –ó–∞–ø—É—Å–∫ —Å–ª—É—à–∞—Ç–µ–ª—è —Å–æ–±—ã—Ç–∏–π Asterisk...
üì° –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è: []
‚úÖ –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ–±—ã—Ç–∏–π –∑–∞–ø—É—â–µ–Ω
üåê –ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 3000
‚úÖ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!
üìä –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
```

## üéâ –®–∞–≥ 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°–¥–µ–ª–∞–π —Ç–µ—Å—Ç–æ–≤—ã–π –∑–≤–æ–Ω–æ–∫:

1. –ü–æ–∑–≤–æ–Ω–∏ —Å –Ω–æ–º–µ—Ä–∞ **101** –Ω–∞ –Ω–æ–º–µ—Ä **102**
2. –û—Ç–≤–µ—Ç—å –Ω–∞ –∑–≤–æ–Ω–æ–∫
3. –ü–æ–≥–æ–≤–æ—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥
4. –ü–æ–≤–µ—Å—å —Ç—Ä—É–±–∫—É

### –°–º–æ—Ç—Ä–∏ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:

```
üìû –ù–û–í–´–ô –ó–í–û–ù–û–ö: 101 -> 102 (Channel: 1732100000.1)
‚úÖ –ó–≤–æ–Ω–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î (ID: 1)
üîÑ –ò–ó–ú–ï–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø: PJSIP/101-00000001 -> Ringing (Channel: 1732100000.1)
üîÑ –ò–ó–ú–ï–ù–ï–ù–ò–ï –°–û–°–¢–û–Ø–ù–ò–Ø: PJSIP/102-00000002 -> Up (Channel: 1732100000.2)
‚úÖ –ó–≤–æ–Ω–æ–∫ –æ—Ç–≤–µ—á–µ–Ω: 101 -> 102
üì¥ –ó–í–û–ù–û–ö –ó–ê–í–ï–†–®–ï–ù: 1732100000.1 (–ü—Ä–∏—á–∏–Ω–∞: Normal Clearing, –ö–æ–¥: 16)
‚úÖ –ó–≤–æ–Ω–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω: 101 -> 102 (–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 25 —Å–µ–∫)
```

### –ü—Ä–æ–≤–µ—Ä—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:

```bash
sqlite3 callcenter.db

# –í SQLite –∫–æ–Ω—Å–æ–ª–∏:
SELECT * FROM calls;
```

–¢—ã —É–≤–∏–¥–∏—à—å:
```
1|1732100000.1|101|102|internal|completed|2025-11-18 10:30:00|2025-11-18 10:30:05|2025-11-18 10:30:30|25|2025-11-18 10:30:00|2025-11-18 10:30:30
```

## üéä –í–°–Å –†–ê–ë–û–¢–ê–ï–¢!

–¢–µ–ø–µ—Ä—å —É —Ç–µ–±—è –µ—Å—Ç—å:
- ‚úÖ –†–∞–±–æ—á–µ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Asterisk
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–≤–æ–Ω–∫–æ–≤
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å—Ç–æ—Ä–∏–µ–π
- ‚úÖ –ü–æ–Ω–∏–º–∞–Ω–∏–µ –∫–∞–∫ –≤—Å—ë —É—Å—Ç—Ä–æ–µ–Ω–æ!

## üîç –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º?

```
–ó–≤–æ–Ω–æ–∫ 101 ‚Üí 102
       ‚Üì
Asterisk Dialplan (extensions.conf)
       ‚Üì
Stasis(callcenter-app) ‚Üê —É–∫–∞–∑–∞–Ω–æ –≤ dialplan
       ‚Üì
ARI –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è —á–µ—Ä–µ–∑ WebSocket
       ‚Üì
backend/listener.go –ª–æ–≤–∏—Ç —Å–æ–±—ã—Ç–∏—è
       ‚Üì
StasisStart ‚Üí —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ –ë–î
ChannelStateChange ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å
ChannelDestroyed ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
       ‚Üì
SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (callcenter.db)
```

## üéØ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —Ç—ã –≤–∏–¥–∏—à—å:
1. –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –æ—Ç Asterisk
2. –ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –µ—Å—Ç—å
3. –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î

–ú–æ–∂–Ω–æ –Ω–∞—á–∞—Ç—å –¥—É–º–∞—Ç—å –æ Frontend:
- –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –∑–≤–æ–Ω–∫–æ–≤
- –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º

**–ò–ª–∏** –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å Backend:
- –î–æ–±–∞–≤–∏—Ç—å HTTP API
- WebSocket –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ë–æ–ª—å—à–µ —Ñ—É–Ω–∫—Ü–∏–π (originate, hangup, etc)

## ‚ùì –ü—Ä–æ–±–ª–µ–º—ã?

### –û—à–∏–±–∫–∞: "–Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ ARI"

–ü—Ä–æ–≤–µ—Ä—å:
```bash
# ARI –¥–æ—Å—Ç—É–ø–µ–Ω?
curl http://192.168.88.206:8088/ari/api-docs/resources.json

# Asterisk –∑–∞–ø—É—â–µ–Ω?
asterisk -rx "core show version"

# –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?
cat /etc/asterisk/ari.conf
```

### –ó–≤–æ–Ω–∫–∏ –Ω–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å dialplan:
```bash
asterisk -rx "dialplan show internal"
```

–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞:
```
Stasis(callcenter-app)
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞:
```bash
ls -la callcenter.db
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ñ–∞–π–ª
```

---

## üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è—é!

–¢—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–ª —Ä–µ–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ:
- –û–±—â–∞–µ—Ç—Å—è —Å Asterisk —á–µ—Ä–µ–∑ ARI
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –∑–≤–æ–Ω–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ò–º–µ–µ—Ç —á–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

–¢–µ–ø–µ—Ä—å —Ç—ã —Ç–æ—á–Ω–æ –ø–æ–Ω–∏–º–∞–µ—à—å –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Asterisk –∏ —á—Ç–æ —Å –Ω–∏–º –¥–µ–ª–∞—Ç—å! üöÄ
